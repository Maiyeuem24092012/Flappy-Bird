<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Flappy Bird - C++ Powered</title>
    <style>
        body { margin: 0; background: #222; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        canvas { border: 4px solid #fff; background: #70c5ce; }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="288" height="512"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// --- 1. ĐỊNH NGHĨA ĐƯỜNG DẪN TÀI NGUYÊN ---
const pathImg = "assets/images";
const pathAud = "assets/images";

const assets = {
    bg: new Image(),
    pipe: new Image(),
    base: new Image(),
    birds: [new Image(), new Image(), new Image()],
    sounds: {
        wing: new Audio(pathAud + 'wing.ogg'),
        point: new Audio(pathAud + 'point.ogg'),
        hit: new Audio(pathAud + 'hit.ogg'),
        die: new Audio(pathAud + 'die.ogg')
    }
};

assets.bg.src = pathImg + 'background-day.png';
assets.pipe.src = pathImg + 'pipe-green.png';
assets.base.src = pathImg + 'base.png';
assets.birds[0].src = pathImg + 'yellowbird-upflap.png';
assets.birds[1].src = pathImg + 'yellowbird-midflap.png';
assets.birds[2].src = pathImg + 'yellowbird-downflap.png';

// --- 2. MÔ PHỎNG BỘ XỬ LÝ TỪ MAIN.CPP ---
let core = {
    birdY: 256,
    velocity: 0,
    score: 0,
    isAlive: true,
    pipes: []
};

function engineStep() {
    if (!core.isAlive) return;

    // Logic y hệt main.cpp
    core.velocity += 0.25; // GRAVITY
    core.birdY += core.velocity;

    if (core.birdY > 400) {
        core.isAlive = false;
        assets.sounds.hit.play();
    }
}

// --- 3. HIỂN THỊ (RENDER) ---
function render() {
    // Vẽ nền
    ctx.drawImage(assets.bg, 0, 0);

    // Vẽ chim (vỗ cánh dựa trên thời gian thực)
    let frame = Math.floor(Date.now() / 100) % 3;
    ctx.drawImage(assets.birds[frame], 50, core.birdY, 34, 24);

    // Vẽ mặt đất
    ctx.drawImage(assets.base, 0, 400, 288, 112);

    // Hiển thị điểm
    ctx.fillStyle = "white";
    ctx.font = "40px Bold Arial";
    ctx.fillText(core.score, 130, 60);

    engineStep();
    requestAnimationFrame(render);
}

// --- 4. ĐIỀU KHIỂN ---
window.onkeydown = (e) => {
    if (e.code === "Space" && core.isAlive) {
        core.velocity = -5; // JUMP_FORCE từ main.cpp
        assets.sounds.wing.play();
    }
};

render();
</script>
</body>
</html>
