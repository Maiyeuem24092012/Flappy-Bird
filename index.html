<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Flappy Bird - C++ Logic Engine</title>
    <style>
        body { margin: 0; background: #222; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: Arial, sans-serif; }
        canvas { border: 4px solid #fff; background-color: #70c5ce; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="288" height="512"></canvas>

<script>
/** * GỘP LOGIC TỪ MAIN.CPP VÀO RENDERER 
 * Core: C++ Physics Logic
 * View: HTML5 Canvas Assets
 */

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// 1. KHAI BÁO ASSETS (Phải khớp chính xác thư mục trên GitHub)
const BASE_PATH = "assets/"; // Đường dẫn gốc trên repo của bạn
const IMG_PATH = BASE_PATH + "images/";
const SND_PATH = BASE_PATH + "audio/";

const res = {
    bg: new Image(),
    bird: new Image(),
    base: new Image(),
    pipe: new Image(),
    s_wing: new Audio(SND_PATH + "wing.ogg"),
    s_hit: new Audio(SND_PATH + "hit.ogg")
};

// Gán nguồn ảnh
res.bg.src = IMG_PATH + "background-day.png";
res.bird.src = IMG_PATH + "yellowbird-midflap.png";
res.base.src = IMG_PATH + "base.png";
res.pipe.src = IMG_PATH + "pipe-green.png";

// 2. CORE LOGIC (Mô phỏng y hệt cấu trúc class trong main.cpp)
class BirdEngine {
    constructor() {
        this.y = 250;
        this.velocity = 0;
        this.gravity = 0.25; // Thông số từ C++
        this.jumpForce = -5.0; // Thông số từ C++
        this.isAlive = true;
        this.score = 0;
    }

    update() {
        if (this.isAlive) {
            this.velocity += this.gravity;
            this.y += this.velocity;
        }

        // Kiểm tra va chạm mặt đất (Tọa độ base là 400)
        if (this.y > 400) {
            this.y = 400;
            if (this.isAlive) res.s_hit.play().catch(()=>{});
            this.isAlive = false;
        }
    }

    flap() {
        if (this.isAlive) {
            this.velocity = this.jumpForce;
            res.s_wing.play().catch(()=>{});
        } else {
            // Nếu đã chết, click sẽ khởi động lại
            Object.assign(this, new BirdEngine()); 
        }
    }
}

const engine = new BirdEngine();

// 3. VÒNG LẶP HIỂN THỊ (RENDERER)
function draw() {
    // Vẽ nền
    ctx.drawImage(res.bg, 0, 0);

    // Vẽ chim dựa trên tọa độ từ Engine
    ctx.drawImage(res.bird, 50, engine.y, 34, 24);

    // Vẽ mặt đất
    ctx.drawImage(res.base, 0, 400, 288, 112);

    // Hiển thị điểm
    ctx.fillStyle = "white";
    ctx.font = "bold 35px Arial";
    ctx.textAlign = "center";
    ctx.fillText(engine.score, canvas.width/2, 60);

    if (!engine.isAlive) {
        ctx.fillStyle = "rgba(0,0,0,0.5)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        ctx.font = "20px Arial";
        ctx.fillText("BẤM ĐỂ CHƠI LẠI", canvas.width/2, canvas.height/2);
    }

    engine.update();
    requestAnimationFrame(draw);
}

// Lắng nghe sự kiện
window.addEventListener("mousedown", () => engine.flap());
window.addEventListener("keydown", (e) => { if(e.code === "Space") engine.flap(); });

// Khởi chạy
draw();
</script>
</body>
</html>
