<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Flappy Bird - C++ Brain Engine</title>
    <style>
        body { margin: 0; background: #222; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        canvas { border: 4px solid #fff; background: #70c5ce; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="288" height="512"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// --- ĐỊNH NGHĨA ĐƯỜNG DẪN CHÍNH XÁC ---
const IMG_PATH = "assets/images/";
const SND_PATH = "assets/audio/";

const assets = {
    bg: new Image(),
    pipe: new Image(),
    base: new Image(),
    birds: [new Image(), new Image(), new Image()],
    sounds: {
        wing: new Audio(SND_PATH + 'wing.ogg'),
        point: new Audio(SND_PATH + 'point.ogg'),
        hit: new Audio(SND_PATH + 'hit.ogg'),
        die: new Audio(SND_PATH + 'die.ogg')
    }
};

// Gán nguồn cho ảnh
assets.bg.src = IMG_PATH + 'background-day.png';
assets.pipe.src = IMG_PATH + 'pipe-green.png';
assets.base.src = IMG_PATH + 'base.png';
assets.birds[0].src = IMG_PATH + 'yellowbird-upflap.png';
assets.birds[1].src = IMG_PATH + 'yellowbird-midflap.png';
assets.birds[2].src = IMG_PATH + 'yellowbird-downflap.png';

// --- BIẾN LOGIC TỪ MAIN.CPP ---
let core = {
    birdY: 256,
    velocity: 0,
    score: 0,
    isAlive: true,
    pipes: []
};

function resetGame() {
    core.birdY = 256; core.velocity = 0; core.score = 0; core.isAlive = true; core.pipes = [];
}

function update() {
    if (!core.isAlive) return;

    core.velocity += 0.25; // Trọng lực từ main.cpp
    core.birdY += core.velocity;

    if (core.birdY > 400) {
        core.isAlive = false;
        assets.sounds.hit.play();
    }
}

function draw() {
    ctx.drawImage(assets.bg, 0, 0);
    
    // Vẽ chim (vỗ cánh)
    let f = Math.floor(Date.now() / 100) % 3;
    ctx.drawImage(assets.birds[f], 50, core.birdY, 34, 24);

    ctx.drawImage(assets.base, 0, 400, 288, 112);
    
    ctx.fillStyle = "white";
    ctx.font = "40px Arial";
    ctx.fillText(core.score, 130, 50);

    update();
    requestAnimationFrame(draw);
}

window.onkeydown = (e) => {
    if (e.code === "Space") {
        if (!core.isAlive) resetGame();
        core.velocity = -5; // Lực nhảy từ main.cpp
        assets.sounds.wing.play();
    }
};

draw();
</script>
</body>
</html>
